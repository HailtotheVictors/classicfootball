var awayTeam={name:"AWAY TEAM",score:0,tol:3,num:0,color:"skyblue",rgb:"rgb(0,162,232)",init:0,controls:"keyboard"},homeTeam={name:"HOME TEAM",score:0,tol:3,num:1,color:"red",rgb:"rgb(237,28,36)",init:11,controls:"keyboard"},teams={away:awayTeam,home:homeTeam},gameClock=180,gameClockReset=180,gameClockInterval=!1,playClock=7,playClockInterval=!1,yardLine=-25,play={down:1,toGo:10},offense="away",conversion=!1,rb={x:0,y:1},df={away:[{x:3,y:0},{x:3,y:1},{x:3,y:2},{x:6,y:1},{x:9,y:1}],home:[{x:8,y:0},{x:8,y:1},{x:8,y:2},{x:5,y:1},{x:2,y:1}]},dfReset={away:[{x:3,y:0},{x:3,y:1},{x:3,y:2},{x:6,y:1},{x:9,y:1}],home:[{x:8,y:0},{x:8,y:1},{x:8,y:2},{x:5,y:1},{x:2,y:1}]},fieldColor="rgb(20,164,20)",gamePrimed=!1,gameActive=!1,defenderInterval=!1,defenderFrequency=500,quarter=1,currentTimeout=!1,wrap=0,goalToGo=!1,possessions=0,gameMode="classic",mousedownID=-1;function chooseColor(e){for(let t of e.parentElement.children)t.children[0].style.display="none";e.children[0].style.display="block",teams[e.parentElement.getAttribute("data-team")].rgb=getComputedStyle(e).backgroundColor.replace(/\s/g,""),teams[e.parentElement.getAttribute("data-team")].color=e.getAttribute("data-color"),document.getElementById(e.parentElement.getAttribute("data-team")+"Timeout").style.backgroundColor=`var(--${e.getAttribute("data-color")})`}function nextScreen(){var e=document.getElementById("launchError"),t=document.getElementsByClassName("teamNameInput");return 0==t[0].value.length?(e.style.display="inline-block",void(e.textContent="Away Team, please enter a name")):t[0].value.length>8?(e.style.display="inline-block",void(e.textContent="Away Team, your name must be 8 characters or fewer")):0==t[1].value.length?(e.style.display="inline-block",void(e.textContent="Home Team, please enter a name")):t[1].value.length>8?(e.style.display="inline-block",void(e.textContent="Home Team, your name must be 8 characters or fewer")):t[0].value===t[1].value?(e.style.display="inline-block",void(e.textContent="The two teams must have different names")):teams.away.rgb==teams.home.rgb?(e.style.display="inline-block",void(e.textContent="The two teams must have different colors")):(gameClock=Number(document.getElementById("periodLength").value),gameClockReset=Number(document.getElementById("periodLength").value),defenderFrequency=Number(document.getElementById("difficulty").value),document.getElementById("setup").children[0].style.display="none",void(document.getElementById("setup").children[1].style.display="block"))}function changeGameMode(e){var t=document.getElementsByClassName("gameMode");for(let o of t)e==o?o.classList.add("gameModeSelected"):o.classList.remove("gameModeSelected");gameMode=e.getAttribute("data-mode")}function launch(){document.getElementById("scoreBoard").style.background=`background: linear-gradient(to right, ${teams.away.rgb} 25%, ${teams.home.rgb} 50%, #333 75%)`,document.getElementById("setup").style.display="none","frenzy"==gameMode?(quarter=5,yardLine=25,updateYardLines(),document.getElementById("prompt").style.display="flex",document.getElementById("announceOT").style.display="block"):"hardcore"==gameMode&&(document.getElementById("puntButton").style.display="none",document.getElementById("fgButton").style.display="none",document.getElementById("patButton").style.display="none"),"frenzy"!=gameMode&&(gamePrimed=!0,startGameClock(),startPlayClock()),awayTeam.controls=document.getElementById("awayControls").value,homeTeam.controls=document.getElementById("homeControls").value,goToControls(awayTeam.controls),setupDpad(),startGame()}function goToControls(e){"keyboard"!=e?(document.getElementById("dpadCont").style.display="block",document.getElementById("gameCont").style.width="calc(100vw - 260px)","left"==e?(document.getElementById("gameCont").style.left="260px",document.getElementById("gameCont").style.right="",document.getElementById("dpadCont").style.left="0px",document.getElementById("dpadCont").style.right=""):(document.getElementById("gameCont").style.right="260px",document.getElementById("gameCont").style.left="",document.getElementById("dpadCont").style.right="0px",document.getElementById("dpadCont").style.left="")):(document.getElementById("dpadCont").style.display="none",document.getElementById("gameCont").style.width="100vw",document.getElementById("gameCont").style.left="0px",document.getElementById("gameCont").style.right="")}function startGame(){resetField(),document.getElementById("setup").style.display="none";var e=["away","home"],t=document.getElementsByClassName("teamName"),o=document.getElementsByClassName("teamTimeouts"),n=document.getElementsByClassName("teamScore"),a=document.getElementsByClassName("teamNameInput"),l=document.getElementsByClassName("teamFinalCont");for(let r=0;r<2;r++)teams[e[r]].name=a[r].value.toUpperCase(),t[r].children[0].textContent=teams[e[r]].name,t[r].style.backgroundColor=`var(--${teams[e[r]].color})`,o[r].style.backgroundColor=`var(--${teams[e[r]].color})`,n[r].style.backgroundColor=`var(--${teams[e[r]].color}-dark)`,l[r].children[0].style.backgroundColor=`var(--${teams[e[r]].color})`,l[r].children[0].textContent=teams[e[r]].name,"maize"!=teams[e[r]].color?l[r].children[1].style.backgroundColor=`var(--${teams[e[r]].color}-dark)`:l[r].children[1].style.backgroundColor="rgb(152,134,5)",document.getElementsByClassName("teamFinalName")[r].textContent=teams[e[r]].name;document.getElementById("downMarker").style.backgroundColor=teams.away.rgb,document.getElementById("scoreTime").children[1].textContent=convertTime(gameClock)}function callTimeout(e){teams[e].tol>0&&!1===currentTimeout&&(currentTimeout=!0,stopPlayClock(),stopGameClock(),teams[e].tol--,document.getElementsByClassName("teamName")[teams[e].num].children[0].textContent="TIMEOUT",document.getElementsByClassName("teamTimeouts")[teams[e].num].children[teams[e].tol].style.visibility="hidden",setTimeout(function(){document.getElementsByClassName("teamName")[teams[e].num].children[0].textContent=teams[e].name,startPlayClock(),currentTimeout=!1},5e3))}function updateScore(e,t){var o,n;switch(t.toUpperCase()){case"TD":o=6,n="TOUCHDOWN";break;case"FG":o=3,n="FIELD GOAL";break;case"2P":o=2,n="2PT CONVERSION";break;case"SF":o=2,n="SAFETY";break;case"DOG":o=0,n="DELAY OF GAME";break;default:o=1,n="PAT"}if(teams[e].score+=o,1===o)document.getElementById(e+"Score").children[0].textContent=teams[e].score;else{var a=document.getElementById("scoreAni");0!==o?a.style.backgroundColor=`var(--${teams[e].color})`:(a.style.backgroundColor="goldenrod",a.children[0].style.color="#333"),a.children[0].textContent=n,a.children[0].style.letterSpacing="5px",a.style.display="block";var l=1,r=setInterval(function(){l++,a.children[0].style.letterSpacing=String(5+.3*l)+"px",40==l&&(document.getElementById(e+"Score").children[0].textContent=teams[e].score),80==l&&(clearInterval(r),setTimeout(function(){a.style.display="none",a.children[0].style.color="white"},500)),"DOG"==t.toUpperCase()&&80==l&&(resetField(),startPlayClock()),"TD"==t.toUpperCase()&&80==l&&(document.getElementById("prompt").style.display="flex",document.getElementById("conversionPrompt").style.display="block",document.getElementById("fourthDownPrompt").style.display="none",document.getElementById("gameFinal").style.display="none",document.getElementById("announceOT").style.display="none"),"FG"==t.toUpperCase()&&80==l&&quarter<5&&gameClock<=0&&changeQuarter(),"SF"==t.toUpperCase()&&80==l&&changePoss("away"==offense?20:-20),"2P"!=t.toUpperCase()&&"FG"!=t.toUpperCase()||80!=l||(conversion=!1,touchback())},18)}}function updateYardLines(){var e=document.getElementsByClassName("yardLine");for(let t=0;t<e.length;t++)e[t].innerHTML=convertYardLine(yardLine+t)}function resetField(){if(updateYardLines(),document.getElementById("lineOfScrimm").style.display="block",ltc=document.getElementById("lineToConvert"),play.toGo>10)ltc.style.display="none";else{let e;ltc.style.display="block",e=1==goalToGo&&"away"==offense?51-yardLine:1==goalToGo&&"home"==offense?Math.abs(39+yardLine):"away"==offense?play.toGo+1:11-play.toGo,ltc.style.left=`calc(((100% - 130px) / 12 * ${e}) + 10px * ${e} + 3px)`}gamePrimed=!0;var e=document.getElementsByClassName("fieldCell");for(let o=0;o<12;o++)for(let n=0;n<3;n++){let a=e[convCoordToNum(o,n)];var t=!1;for(let e of dfReset[offense])if(e.x==o&&e.y==n){t=!0;break}t?a.style.backgroundColor=teams[getDefense()].rgb:rb.x==o&&rb.y==n?a.style.backgroundColor=teams[offense].rgb:a.style.backgroundColor=fieldColor}resetPositions()}function move(e,t,o){if(gamePrimed){0==gameActive&&(gameActive=!0,moveDefenders(),stopPlayClock(),conversion||startGameClock());var n=document.getElementsByClassName("fieldCell"),a={};if(a.x=e.x+t.x,a.y=e.y+t.y,a.x<0&&o==offense&&"away"!=o){if(a.x=11,yardLine-=12,wrap+=11,play.toGo<=10||wrap-play.toGo>=11)document.getElementById("lineToConvert").style.display="none";else if(wrap-play.toGo!=0){let e=document.getElementById("lineToConvert");e.style.display="block",e.style.left=`calc(((100%-130px)/12* ${11-play.toGo+wrap}) +10px* ${11-play.toGo+wrap} +3px)`}document.getElementById("lineOfScrimm").style.display="none",updateYardLines()}else if(a.x<0&&(o==offense&&"away"==o||o!=offense))a.x=0;else if(a.x>11&&o==offense&&"home"!=o){if(a.x=0,yardLine+=12,wrap+=11,play.toGo<=10||wrap-play.toGo>=11)document.getElementById("lineToConvert").style.display="none";else if(wrap-play.toGo!=0){let e=document.getElementById("lineToConvert");e.style.display="block",e.style.left=`calc(((100% - 130px) / 12 * ${play.toGo-wrap}) + 10px * ${play.toGo-wrap} + 3px)`}document.getElementById("lineOfScrimm").style.display="none",updateYardLines()}else a.x>11&&(o==offense&&"home"==o||o!=offense)&&(a.x=11);a.y<0?a.y=0:a.y>2&&(a.y=2);var l=n[convCoordToNum(a.x,a.y)],r=getComputedStyle(l).backgroundColor.replace(/\s/g,"");if(r!=teams[o].rgb)if(r==teams[getOpponent(o)].rgb)playerTackled(),gameActive=!1,gamePrimed=!1;else{if(n[convCoordToNum(e.x,e.y)].style.backgroundColor=fieldColor,l.style.backgroundColor=`var(--${teams[o].color})`,"away"==offense)var s=yardLine+getDistance(a.x);else s=yardLine-getDistance(a.x);if((s>=50&&"away"==offense&&o==offense||s<=-50&&"home"==offense&&o==offense)&&(playEndedAfterScore(),updateScore(offense,conversion?"2p":"td")),o===offense)rb=a;else for(let t of df[getOpponent(o)])e.x===t.x&&e.y===t.y&&(t.x=a.x,t.y=a.y)}else n[convCoordToNum(e.x,e.y)].style.backgroundColor=teams[o].rgb}}function mousedown(e,t){whilemousedown(t),-1==mousedownID&&(mousedownID=setInterval(function(){whilemousedown(t)},80))}function mouseup(e){-1!=mousedownID&&(clearInterval(mousedownID),mousedownID=-1)}function whilemousedown(e){1==gamePrimed&&move(rb,e,offense)}function setupDpad(){let e=document.getElementById("fullDpad").children,t=[{x:0,y:-1},{x:0,y:1},{x:-1,y:0},{x:1,y:0}];for(var o=0;o<e.length;o++)!function(o){e[o].addEventListener("touchstart",function(){mousedown(event,t[o])}),e[o].addEventListener("touchend",function(){mouseup(event,t[o])})}(o)}function playerTackled(){stopDefenders(),stopGameClock(),gamePrimed=!1,gameActive=!1;var e=0,t=document.getElementsByClassName("fieldCell")[convCoordToNum(rb.x,rb.y)],o=setInterval(function(){t.style.backgroundColor=e%2==0?fieldColor:teams[offense].rgb,4==++e&&(clearInterval(o),playerTackledCallback(rb.x))},500)}function playerTackledCallback(e){gameClock<=0?(gameActive=!1,gamePrimed=!1,changeQuarter()):nextPlay()}function nextPlay(){if(conversion)return conversion=!1,void touchback();var e;if(e=play.toGo-getDistance(rb.x)-12*wrap/11,"away"==offense?yardLine+=getDistance(rb.x):yardLine-=getDistance(rb.x),e<=0)play.down=1,play.toGo=10;else if(play.down<3)play.down++,play.toGo=e;else{if(3==play.down)return play.toGo=e,play.down=4,updateDownMarker(),stopPlayClock(),document.getElementById("prompt").style.display="flex",document.getElementById("conversionPrompt").style.display="none",document.getElementById("fourthDownPrompt").style.display="block",document.getElementById("gameFinal").style.display="none",document.getElementById("announceOT").style.display="none",document.getElementById("fourthMessage").textContent=`It's 4th & ${play.toGo}!`,void(document.getElementById("fgChance").textContent=`Your chance is ${fieldGoalChance(yardLine)}%.`);quarter<5?changePoss("away"==offense?yardLine+getDistance(rb.x)+wrap:yardLine-getDistance(rb.x)-wrap):touchback()}1==play.down&&(yardLine-10<=-50||yardLine+10>=50)&&(goalToGo=!0),updateDownMarker(),startGameClock(),startPlayClock(),gamePrimed=!0,rb.y=1,rb.x=teams[offense].init,resetField(),wrap=0}function playEndedAfterScore(){rb.y=1,rb.x=teams[offense].init,stopGameClock(),stopDefenders(),gamePrimed=!1,gameActive=!1,wrap=0}function moveDefenders(){if(!1===defenderInterval){var e=0,t=3,o=[{x:1,y:0},{x:-1,y:0},{x:0,y:1},{x:0,y:-1}];defenderInterval=setInterval(function(){if(e>=5)var n=o[Math.floor(4*Math.random())];else if("away"==offense)n={x:-1,y:0};else n={x:1,y:0};move(df[offense][Math.floor(Math.random()*t)],n,getDefense()),5==e&&(t=5),e++},defenderFrequency)}}function stopDefenders(){clearInterval(defenderInterval),defenderInterval=!1}function updateDownMarker(){if(goalToGo)var e=`<span>${ordinal(play.down)} & Goal</span>`;else e=`<span>${ordinal(play.down)} & ${play.toGo}</span>`;var t=e;t="away"!=offense||conversion?conversion?"away"==offense&&conversion?"<span>2PT ATT</span> <img src='right.png'>":"<img src='left.png'> <span>2PT ATT</span>":"<img src='left.png'>"+e:e+"<img src='right.png'>";var o=document.getElementById("downMarker");o.style.backgroundColor=teams[offense].rgb,o.innerHTML=t}function changePoss(e){if(quarter>4)var t=advanceOT();if(quarter>4&&t)e="away"==offense?-25:25;else if(quarter>4&&!t)return;goalToGo=!1,yardLine=e;var o=document.getElementById("lineOfScrimm"),n=document.getElementById("lineToConvert");"away"==offense?(offense="home",o.style.left="calc(((100% - 130px) / 12 * 11) + 10px * 11 + 3px)",n.style.left="calc(((100% - 130px) / 12 * 1) + 10px * 1 + 3px)"):(offense="away",n.style.left="calc(((100% - 130px) / 12 * 11) + 10px * 11 + 3px)",o.style.left="calc(((100% - 130px) / 12 * 1) + 10px * 1 + 3px)"),goToControls(teams[offense].controls),play={down:1,toGo:10},rb.y=1,rb.x=teams[offense].init,stopPlayClock(),stopGameClock(),updateDownMarker(),updateYardLines(),resetField(),setTimeout(function(){playClock=7,startPlayClock(),quarter<5&&startGameClock()},500)}function touchback(){changePoss("away"==offense&&quarter<5||"home"==offense&&quarter>4?25:-25)}function punt(){document.getElementById("prompt").style.display="none",gameClock-=3;var e=Math.floor(25*Math.random())+35;if("away"==offense)var t=yardLine+e;else t=yardLine-e;t<=-50?t=-30:t>=50&&(t=30),changePoss(t),gameClock<=0&&changeQuarter()}function kickFieldGoal(){document.getElementById("prompt").style.display="none";var e=Number(fieldGoalChance(yardLine)),t=100*Math.random();gameClock-=3,t<=e?updateScore(offense,"fg"):(document.getElementById("downMarker").innerHTML="<span>No Good</span>",setTimeout(function(){changePoss(yardLine),gameClock<=0&&changeQuarter()},1500))}function goForTwo(){stopGameClock();var e=document.getElementById("lineOfScrimm"),t=document.getElementById("lineToConvert");e.style.display="block",e.style.left="calc(((100% - 130px) / 12) + 13px)",t.style.display="block",t.style.left="calc(((100% - 130px) / 2) + 63px)",resetPositions(),conversion=!0,document.getElementById("prompt").style.display="none",yardLine="away"==offense?45:-45,updateYardLines(),resetField(),updateDownMarker(),startPlayClock()}function resetPositions(){rb.x=teams[offense].init,rb.y=1;for(var e=0;e<dfReset[offense].length;e++)df[offense][e].x=dfReset[offense][e].x,df[offense][e].y=dfReset[offense][e].y}function goForFourth(){document.getElementById("prompt").style.display="none",resetPositions(),startGameClock(),startPlayClock(),resetField()}function startGameClock(){quarter>4||(document.getElementById("scoreTime").children[1].textContent=convertTime(gameClock),!1===gameClockInterval&&(gameClockInterval=setInterval(function(){gameClock--,document.getElementById("scoreTime").children[1].textContent=convertTime(gameClock),gameClock<=0&&(gameActive||(stopPlayClock(),changeQuarter()),stopGameClock())},1e3)))}function stopGameClock(){clearInterval(gameClockInterval),gameClockInterval=!1}function startPlayClock(){gamePrimed=!0;var e=document.getElementById("playClock").children[0];e.textContent=playClock,e.parentElement.classList.remove("within"),!1===playClockInterval&&(playClockInterval=setInterval(function(){playClock--,e.textContent=playClock,2==playClock&&e.parentElement.classList.add("within"),playClock<=0&&(stopPlayClock(),stopGameClock(),yardLine-5<=-50&&"away"==offense||yardLine+5>=50&&"home"==offense?updateScore(getDefense(),"sf"):(gamePrimed=!1,"away"==offense?yardLine-=5:yardLine+=5,play.toGo+=5,setTimeout(function(){updateYardLines(),updateDownMarker(),updateScore(offense,"dog")},750)))},1e3))}function stopPlayClock(){clearInterval(playClockInterval),playClockInterval=!1,playClock=7}function changeQuarter(){gamePrimed=!1,gameActive=!1,quarter++;var e=document.getElementById("scoreTime");quarter<5?e.children[0].textContent=`End ${ordinal(quarter-1)}`:awayTeam.score==homeTeam.score?5==quarter?(e.children[0].textContent="End Reg",document.getElementById("prompt").style.display="flex",document.getElementById("conversionPrompt").style.display="none",document.getElementById("fourthDownPrompt").style.display="none",document.getElementById("gameFinal").style.display="none",document.getElementById("announceOT").style.display="block"):e.children[0].textContent=`End ${ordinal(quarter-1)}`:endGame(),e.children[1].textContent="",quarter%2==0&&setTimeout(function(){gameClock=gameClockReset,e.children[0].textContent=ordinal(quarter),e.children[1].textContent=convertTime(gameClock),startGameClock(),startPlayClock(),nextPlay()},2e3),3==quarter&&setTimeout(function(){"home"==offense&&(offense="away"),changePoss(25),gameClock=gameClockReset,e.children[0].textContent=ordinal(quarter),e.children[1].textContent=convertTime(gameClock),awayTeam.tol=3,homeTeam.tol=3;var t=document.getElementsByClassName("teamTimeouts");for(let e of t){let t=e.children;for(let e of t)e.style.visibility="visible"}startGameClock(),startPlayClock()},2e3)}function endGame(){stopGameClock(),document.getElementById("prompt").style.display="flex",document.getElementById("prompt").style.height="100vh",document.getElementById("conversionPrompt").style.display="none",document.getElementById("fourthDownPrompt").style.display="none",document.getElementById("gameFinal").style.display="block",document.getElementById("announceOT").style.display="none";var e=document.getElementsByClassName("teamFinalCont");e[0].children[1].textContent=teams.away.score,e[1].children[1].textContent=teams.home.score,teams.away.score>teams.home.score?e[0].children[1].style.color="gold":e[1].children[1].style.color="gold"}function launchOT(){document.getElementById("puntButton").remove(),teams.away.tol=2,teams.home.tol=2;var e=document.getElementsByClassName("teamTimeouts");for(let t of e)for(let e=0;e<t.children.length;e++)t.children[e].style.visibility=2!==e?"visible":"hidden";offense="home",touchback(),gameClock=100,possessions=0,document.getElementById("scoreTime").children[1].style.display="none",document.getElementById("scoreTime").children[0].textContent="OT"}function advanceOT(){return++possessions%2!=0||(teams.away.score==teams.home.score?(7==++quarter?document.getElementById("patButton").remove():9==quarter&&document.getElementById("fgButton").remove(),document.getElementById("scoreTime").children[0].textContent=ordinal(quarter),!0):(gameActive=!1,gamePrimed=!1,setTimeout(function(){stopPlayClock()},1e3),document.getElementsByClassName("teamFinalPeriod")[0].textContent=`Final-${ordinal(quarter)}`,endGame(),!1))}function getDistance(e){return"away"==offense?e:11-e}function convertTime(e){var t=e%60,o=(e-t)/60;return t<10&&t>-1?t="0"+t:t<0&&(t="00"),o+":"+t}function ordinal(e){switch(e){case 1:return"1st";case 2:return"2nd";case 3:return"3rd";case 4:return"4th";case 5:return"OT";default:return`${e-4}OT`}}function convertYardLine(e){return"home"==offense&&(e-=11),e<-50||e>50?"-":50==e||-50==e?"G":0===e?"50":e%10==0&&e<0?"<img src='left.png'>"+String(50-Math.abs(e)):e%10==0&&e>0?String(Math.abs(50-Math.abs(e)))+"<img src='right.png'>":e>0?String(Math.abs(50-Math.abs(e))):e<0?String(Math.abs(50-Math.abs(e))):"ERR"}function convCoordToNum(e,t){return 12*t+e}function convNumToCoord(e){return{x:e%12,y:(e-e%12)/12}}function getDefense(){return"away"==offense?"home":"away"}function getOpponent(e){return"away"==e?"home":"away"}function fieldGoalChance(e){var t;t="home"==offense?Math.abs(50+e):Math.abs(50-e);var o=-.04*Math.pow(t,2)+100;return o<0&&(o=0),o.toFixed(1)}function dpadTimeout(e){!0===gamePrimed&&!1===gameActive&&callTimeout(e)}window.onkeydown=function(e){"away"==offense&&1==gamePrimed?(87==e.keyCode&&move(rb,{x:0,y:-1},"away"),83==e.keyCode&&move(rb,{x:0,y:1},"away"),65==e.keyCode&&move(rb,{x:-1,y:0},"away"),68==e.keyCode&&move(rb,{x:1,y:0},"away")):"home"==offense&&1==gamePrimed&&(73==e.keyCode&&move(rb,{x:0,y:-1},"home"),75==e.keyCode&&move(rb,{x:0,y:1},"home"),74==e.keyCode&&move(rb,{x:-1,y:0},"home"),76==e.keyCode&&move(rb,{x:1,y:0},"home")),!0===gamePrimed&&!1===gameActive&&84===e.keyCode?callTimeout("away"):!0===gamePrimed&&!1===gameActive&&80===e.keyCode&&callTimeout("home")};
